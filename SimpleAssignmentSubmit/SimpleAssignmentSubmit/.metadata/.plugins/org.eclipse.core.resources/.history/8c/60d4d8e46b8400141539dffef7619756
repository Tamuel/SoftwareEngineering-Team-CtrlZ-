package GUIPanel;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Iterator;

import javax.swing.BorderFactory;
import javax.swing.JPanel;

import Account.Account;
import Account.Student;
import Assignment.Assignment;
import Assignment.Subject;
import GUIFrame.BulletinBoardFrame;
import GuiComponent.SimpleButton;
import GuiComponent.SimpleTextArea;

public class AssignmentList extends JPanel{
	
	private Subject subject;
	private BulletinBoardFrame boardFrame;
	private TitleBar titleBar;
	private AssignmentPanel assignmentPanel;
	
	private ArrayList<SimpleButton> assignmentButtons;

	private int assignmentButtonHeight = 80;
	private int assignmentButtonWidth = 250;
	private int xBorder = 10;
	private int yBorder = 10;
	private int height;

	private Color backgroundColor = new Color(245, 245, 245);
	private Color buttonColor = new Color(255, 255, 255);
	private Color fontColor = new Color(100, 100, 100);
	
	public AssignmentList(int height, Subject subject, BulletinBoardFrame boardFrame, TitleBar titleBar) {
		assignmentButtons = new ArrayList<SimpleButton>();
		
		this.titleBar = titleBar;
		this.subject = subject;
		this.boardFrame = boardFrame;

		this.setLayout(null);
		
		for(int i = 0; i < subject.getAssignments().size(); i++) {
			SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy.MM.dd HH:mm:ss");
			
			SimpleButton temp = new SimpleButton(subject.getAssignments().get(i).getTopic(),
					dateFormat.format(subject.getAssignments().get(i).getDeadline()) + " ±îÁö",
					assignmentButtonWidth, assignmentButtonHeight);
			temp.setLocation(xBorder, yBorder + (assignmentButtonHeight + yBorder) * i);
			temp.addActionListener(new assignmentButtonListener());
			temp.setBackground(buttonColor);
			temp.setFontColor(fontColor, fontColor);
			temp.setBorder(BorderFactory.createLineBorder(new Color(210, 210, 210), 1));
			
			if(i == subject.getAssignments().size() - 1)
				this.height = temp.getY() + assignmentButtonHeight + yBorder;
			
			assignmentButtons.add(temp);
			this.addButton(assignmentButtons.get(i));
		}
		//this.setSize(xBorder * 2 + assignmentButtonWidth, assignmentButtons.get(subject.getAssignments().size() - 1).getY() + assignmentButtonHeight + yBorder);
		
		if(this.height > height)
			height = this.height;
		
		this.setBackground(backgroundColor);
		this.setBorder(BorderFactory.createMatteBorder(0, 0, 0, 1, new Color(200, 200, 200)));
		this.setSize(xBorder * 2 + assignmentButtonWidth, height);
		this.setPreferredSize(new Dimension(this.getWidth(), this.getHeight()));
	}

	private class assignmentButtonListener implements ActionListener {
		public void actionPerformed(ActionEvent ev) {
			removeAssignmentPanel();
				
			assignmentPanel = new AssignmentPanel(thisHeight(),
			subject.getAssignments().get(assignmentButtons.indexOf((SimpleButton)ev.getSource())), boardFrame);
			assignmentPanel.setLocation(thisRight() + xBorder, yBorder + 30);
			boardFrame.add(assignmentPanel);
			assignmentPanel.reSize();
			titleBar.setPath(subject.getAssignments().get(assignmentButtons.indexOf((SimpleButton)ev.getSource())));
			boardFrame.repaint();
		}
	}
	
	public void removeAssignmentPanel() {
		if(assignmentPanel != null) {
			assignmentPanel.removeMyAssignmentPanel();
			boardFrame.remove(assignmentPanel);
		}
	}

	public void addButton(SimpleButton button) {
		this.add(button);
	}
	
	public int thisHeight() {
		return this.getHeight();
	}
	
	public int thisRight() {
		return this.getX() + this.getWidth() + 300;
	}
}
